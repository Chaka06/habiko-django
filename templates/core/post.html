{% extends "base.html" %}
{% block title %}Publier une annonce gratuite · HABIKO CI{% endblock %}
{% block description %}Publiez votre annonce immobilière gratuitement sur HABIKO CI. Maisons à vendre, villas à louer, appartements et terrains en Côte d'Ivoire. Inscription rapide, publication immédiate.{% endblock %}
{% block keywords %}publier annonce, annonce gratuite, habiko, habiko ci, immobilier côte d'ivoire, maison à vendre abidjan, villa à louer, appartement abidjan, terrain à vendre, côte d'ivoire, abidjan{% endblock %}
{% block content %}
<section class="max-w-2xl mx-auto bg-white rounded-2xl p-4 md:p-6 border border-gray-200 shadow-sm">
  <h1 class="text-2xl font-bold text-gray-900 mb-6">Publier une annonce gratuite sur HABIKO CI</h1>
  
  {% if messages %}
    {% for message in messages %}
      <div class="mb-4 p-3 rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}
    
    <!-- Titre -->
    <div>
      <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.title.label }}</label>
      {{ form.title }}
      {% if form.title.errors %}
        <div class="text-red-600 text-sm mt-1">{{ form.title.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- Catégorie -->
    <div>
      <label for="{{ form.category.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.category.label }}</label>
      {{ form.category }}
      {% if form.category.errors %}
        <div class="text-red-600 text-sm mt-1">{{ form.category.errors.0 }}</div>
      {% endif %}
    </div>


           <!-- Sous-catégories -->
           <div>
             <fieldset>
               <legend class="block text-sm font-medium text-gray-700 mb-2">{{ form.subcategories.label }}</legend>
               <div id="subcategories-container" class="grid grid-cols-2 md:grid-cols-3 gap-2">
                 {% for choice in form.subcategories %}
                   <label for="{{ choice.id_for_label }}" class="flex items-center space-x-2 text-sm p-2 border border-gray-300 rounded hover:bg-gray-50 cursor-pointer">
                     {{ choice.tag }}
                     <span>{{ choice.choice_label }}</span>
                   </label>
                 {% endfor %}
               </div>
               {% if form.subcategories.errors %}
                 <div class="text-red-600 text-sm mt-1">{{ form.subcategories.errors.0 }}</div>
               {% endif %}
             </fieldset>
           </div>

    <!-- Champs dynamiques selon la catégorie -->
    <div id="category-specific-fields" class="space-y-4 hidden">
      <!-- Champs pour Villas et Résidences -->
      <div id="fields-villas_residences" class="category-fields hidden">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Informations détaillées</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="id_prix_jours_ouvrables" class="block text-sm font-medium text-gray-700 mb-2">Prix jours ouvrables (FCFA/jour)</label>
            <input type="number" name="prix_jours_ouvrables" id="id_prix_jours_ouvrables" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 50000">
            <p class="text-xs text-gray-500 mt-1">Prix pour les jours ouvrables (lundi-vendredi)</p>
          </div>
          <div>
            <label for="id_prix_jours_non_ouvrables" class="block text-sm font-medium text-gray-700 mb-2">Prix jours non ouvrables (FCFA/jour)</label>
            <input type="number" name="prix_jours_non_ouvrables" id="id_prix_jours_non_ouvrables" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 75000">
            <p class="text-xs text-gray-500 mt-1">Prix pour les weekends et jours fériés</p>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          <div>
            <label for="id_surface_villas" class="block text-sm font-medium text-gray-700 mb-2">Surface (m²)</label>
            <input type="number" name="surface" id="id_surface_villas" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 120">
          </div>
          <div>
            <label for="id_nombre_chambres_villas" class="block text-sm font-medium text-gray-700 mb-2">Nombre de chambres</label>
            <input type="number" name="nombre_chambres" id="id_nombre_chambres_villas" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 3">
          </div>
        </div>
      </div>

      <!-- Champs pour Maisons et Appartements -->
      <div id="fields-maisons_appartements" class="category-fields hidden">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Informations détaillées</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="id_prix_vente" class="block text-sm font-medium text-gray-700 mb-2">Prix de vente (FCFA)</label>
            <input type="number" name="prix_vente" id="id_prix_vente" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 50000000">
          </div>
          <div>
            <label for="id_surface_maisons" class="block text-sm font-medium text-gray-700 mb-2">Surface (m²)</label>
            <input type="number" name="surface" id="id_surface_maisons" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 90">
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          <div>
            <label for="id_nombre_chambres_maisons" class="block text-sm font-medium text-gray-700 mb-2">Nombre de chambres</label>
            <input type="number" name="nombre_chambres" id="id_nombre_chambres_maisons" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 2">
          </div>
          <div>
            <label for="id_nombre_salles_bain" class="block text-sm font-medium text-gray-700 mb-2">Nombre de salles de bain</label>
            <input type="number" name="nombre_salles_bain" id="id_nombre_salles_bain" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 1">
          </div>
        </div>
      </div>

      <!-- Champs pour Terrains -->
      <div id="fields-terrains" class="category-fields hidden">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Informations détaillées</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="id_prix_terrain" class="block text-sm font-medium text-gray-700 mb-2">Prix (FCFA)</label>
            <input type="number" name="prix" id="id_prix_terrain" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 12000000">
          </div>
          <div>
            <label for="id_surface_terrain" class="block text-sm font-medium text-gray-700 mb-2">Surface (m²)</label>
            <input type="number" name="surface" id="id_surface_terrain" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 500">
          </div>
        </div>
      </div>

      <!-- Champs pour Locations -->
      <div id="fields-locations" class="category-fields hidden">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Informations détaillées</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label for="id_loyer_mensuel" class="block text-sm font-medium text-gray-700 mb-2">Loyer mensuel (FCFA)</label>
            <input type="number" name="loyer_mensuel" id="id_loyer_mensuel" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 450000">
          </div>
          <div>
            <label for="id_charges" class="block text-sm font-medium text-gray-700 mb-2">Charges (FCFA/mois)</label>
            <input type="number" name="charges" id="id_charges" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 50000">
            <p class="text-xs text-gray-500 mt-1">Charges mensuelles</p>
          </div>
          <div>
            <label for="id_caution" class="block text-sm font-medium text-gray-700 mb-2">Caution (FCFA)</label>
            <input type="number" name="caution" id="id_caution" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 900000">
            <p class="text-xs text-gray-500 mt-1">Dépôt de garantie</p>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          <div>
            <label for="id_surface_locations" class="block text-sm font-medium text-gray-700 mb-2">Surface (m²)</label>
            <input type="number" name="surface" id="id_surface_locations" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 65">
          </div>
          <div>
            <label for="id_nombre_chambres_locations" class="block text-sm font-medium text-gray-700 mb-2">Nombre de chambres</label>
            <input type="number" name="nombre_chambres" id="id_nombre_chambres_locations" step="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Ex: 2">
          </div>
        </div>
      </div>
    </div>

    <!-- Description -->
    <div>
      <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.description.label }}</label>
      {{ form.description }}
      {% if form.description.errors %}
        <div class="text-red-600 text-sm mt-1">{{ form.description.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- Ville -->
    <div>
      <label for="{{ form.city.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.city.label }}</label>
      {{ form.city }}
      {% if form.city.errors %}
        <div class="text-red-600 text-sm mt-1">{{ form.city.errors.0 }}</div>
      {% endif %}
    </div>

    <!-- Téléphones -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="{{ form.phone1.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.phone1.label }}</label>
        {{ form.phone1 }}
        {% if form.phone1.errors %}
          <div class="text-red-600 text-sm mt-1">{{ form.phone1.errors.0 }}</div>
        {% endif %}
      </div>
      <div>
        <label for="{{ form.phone2.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.phone2.label }}</label>
        {{ form.phone2 }}
        {% if form.phone2.errors %}
          <div class="text-red-600 text-sm mt-1">{{ form.phone2.errors.0 }}</div>
        {% endif %}
      </div>
    </div>

    <!-- Méthodes de contact -->
    <div>
      <fieldset>
        <legend class="block text-sm font-medium text-gray-700 mb-2">{{ form.contact_methods.label }}</legend>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          {% for choice in form.contact_methods %}
            <label for="{{ choice.id_for_label }}" class="flex items-center space-x-2 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
              {{ choice.tag }}
              <span class="text-sm font-medium">{{ choice.choice_label }}</span>
            </label>
          {% endfor %}
        </div>
        <p class="text-gray-500 text-sm mt-2">{{ form.contact_methods.help_text }}</p>
        {% if form.contact_methods.errors %}
          <div class="text-red-600 text-sm mt-1">{{ form.contact_methods.errors.0 }}</div>
        {% endif %}
      </fieldset>
    </div>

           <!-- Photos -->
           <div>
             <h3 class="block text-sm font-medium text-gray-700 mb-4">Photos (optionnelles)</h3>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
               <div>
                 <label for="{{ form.image1.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.image1.label }}</label>
                 {{ form.image1 }}
                 {% if form.image1.errors %}
                   <div class="text-red-600 text-sm mt-1">{{ form.image1.errors.0 }}</div>
                 {% endif %}
               </div>
               
               <div>
                 <label for="{{ form.image2.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.image2.label }}</label>
                 {{ form.image2 }}
                 {% if form.image2.errors %}
                   <div class="text-red-600 text-sm mt-1">{{ form.image2.errors.0 }}</div>
                 {% endif %}
               </div>
               
               <div>
                 <label for="{{ form.image3.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.image3.label }}</label>
                 {{ form.image3 }}
                 {% if form.image3.errors %}
                   <div class="text-red-600 text-sm mt-1">{{ form.image3.errors.0 }}</div>
                 {% endif %}
               </div>
               
               <div>
                 <label for="{{ form.image4.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.image4.label }}</label>
                 {{ form.image4 }}
                 {% if form.image4.errors %}
                   <div class="text-red-600 text-sm mt-1">{{ form.image4.errors.0 }}</div>
                 {% endif %}
               </div>
               
               <div>
                 <label for="{{ form.image5.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">{{ form.image5.label }}</label>
                 {{ form.image5 }}
                 {% if form.image5.errors %}
                   <div class="text-red-600 text-sm mt-1">{{ form.image5.errors.0 }}</div>
                 {% endif %}
               </div>
             </div>
             <p class="text-gray-500 text-sm mt-2">Vous pouvez ajouter jusqu'à 5 photos. Toutes les photos sont optionnelles.</p>
           </div>

    <!-- Bouton submit -->
    <div class="flex justify-end space-x-3">
      <a href="/dashboard" class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium">Annuler</a>
      <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-medium">
        Publier l'annonce
      </button>
    </div>
  </form>
    </section>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const categorySelect = document.querySelector('select[id*="category"]');
        const subcategoriesContainer = document.getElementById('subcategories-container');
        
        const subcategoryMapping = {
            'maisons_appartements': [
                'Maison à vendre',
                'Appartement à vendre',
                'Studio à vendre',
                'Duplex à vendre',
                'Villa à vendre',
                'Maison meublée à vendre',
                'Appartement meublé à vendre'
            ],
            'villas_residences': [
                'Villa de luxe',
                'Résidence meublée',
                'Résidence de standing',
                'Villa avec piscine',
                'Résidence sécurisée'
            ],
            'terrains': [
                'Terrain à vendre',
                'Terrain constructible',
                'Terrain viabilisé',
                'Parcelle à vendre',
                'Terrain commercial'
            ],
            'locations': [
                'Maison à louer',
                'Appartement à louer',
                'Studio à louer',
                'Villa à louer',
                'Résidence meublée à louer'
            ]
        };
        
        function updateSubcategories() {
            const selectedCategory = categorySelect.value;
            const subcategories = subcategoryMapping[selectedCategory] || [];
            
            // Vider le conteneur
            subcategoriesContainer.innerHTML = '';
            
            // Ajouter les nouvelles sous-catégories
            subcategories.forEach((subcategory, index) => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 text-sm p-2 border border-gray-300 rounded hover:bg-gray-50 cursor-pointer';
                
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.name = 'subcategories';
                input.value = subcategory;
                input.id = `id_subcategories_${index}`;
                input.className = 'mr-2';
                
                const span = document.createElement('span');
                span.textContent = subcategory;
                
                label.appendChild(input);
                label.appendChild(span);
                subcategoriesContainer.appendChild(label);
            });
        }
        
        function updateCategoryFields() {
            const selectedCategory = categorySelect.value;
            const categoryFieldsContainer = document.getElementById('category-specific-fields');
            
            // Cacher tous les champs de catégorie
            document.querySelectorAll('.category-fields').forEach(field => {
                field.classList.add('hidden');
            });
            
            // Afficher les champs spécifiques à la catégorie sélectionnée
            if (selectedCategory) {
                const fieldsDiv = document.getElementById(`fields-${selectedCategory}`);
                if (fieldsDiv) {
                    fieldsDiv.classList.remove('hidden');
                    categoryFieldsContainer.classList.remove('hidden');
                } else {
                    categoryFieldsContainer.classList.add('hidden');
                }
            } else {
                categoryFieldsContainer.classList.add('hidden');
            }
        }
        
        // Écouter les changements de catégorie
        categorySelect.addEventListener('change', function() {
            updateSubcategories();
            updateCategoryFields();
        });
        
        // Initialiser au chargement de la page
        updateSubcategories();
        updateCategoryFields();
    });
    </script>
    {% endblock %}