<!DOCTYPE html>
<html lang="fr" class="h-full">
  {% load static %}
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}KIABA · Rencontres & Annonces Adultes{% endblock %}</title>
    <meta
      name="description"
      content="{% block description %}KIABA - Site de rencontres adultes et annonces d'escorte en Côte d'Ivoire. Rencontres, escort girls, escort boys et transgenres partout en Côte d'Ivoire.{% endblock %}"
    />
    <meta
      name="keywords"
      content="{% block keywords %}kiaba, kiaba rencontres, site de rencontre adulte, escort girl, escort boy, transgenre, annonces adultes, escorte côte d'ivoire, abidjan, bouaké, daloa, yamoussoukro{% endblock %}"
    />
    <meta name="author" content="KIABA" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="fr" />
    <meta name="geo.region" content="CI" />
    <meta name="geo.country" content="Côte d'Ivoire" />
    <meta name="geo.placename" content="Abidjan" />
    <meta name="distribution" content="global" />
    <meta name="rating" content="general" />
    <meta name="revisit-after" content="1 days" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="{% block og_url %}https://ci-kiaba.com{% endblock %}"
    />
    <meta
      property="og:title"
      content="{% block og_title %}KIABA · Rencontres & Annonces Adultes{% endblock %}"
    />
    <meta
      property="og:description"
      content="{% block og_description %}KIABA - Site de rencontres adultes et annonces d'escorte en Côte d'Ivoire. Rencontres, escort girls, escort boys et transgenres partout en Côte d'Ivoire.{% endblock %}"
    />
    <meta
      property="og:image"
      content="{% block og_image %}https://ci-kiaba.com{% static 'img/logo.png' %}?v=2{% endblock %}"
    />
    <meta property="og:site_name" content="KIABA" />
    <meta property="og:locale" content="fr_CI" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta
      property="twitter:url"
      content="{% block twitter_url %}https://ci-kiaba.com{% endblock %}"
    />
    <meta
      property="twitter:title"
      content="{% block twitter_title %}KIABA · Rencontres & Annonces Adultes{% endblock %}"
    />
    <meta
      property="twitter:description"
      content="{% block twitter_description %}KIABA - Site de rencontres adultes et annonces d'escorte en Côte d'Ivoire. Rencontres, escort girls, escort boys et transgenres partout en Côte d'Ivoire.{% endblock %}"
    />
    <meta
      property="twitter:image"
      content="{% block twitter_image %}https://ci-kiaba.com{% static 'img/logo.png' %}?v=2{% endblock %}"
    />

    <!-- Canonical URL -->
    <link
      rel="canonical"
      href="{% block canonical_url %}https://ci-kiaba.com{% endblock %}"
    />

    <!-- Hreflang Tags for SEO Local -->
    <link
      rel="alternate"
      hreflang="fr-CI"
      href="{% block hreflang_fr_ci %}https://ci-kiaba.com{% endblock %}"
    />
    <link
      rel="alternate"
      hreflang="x-default"
      href="{% block hreflang_default %}https://ci-kiaba.com{% endblock %}"
    />

    <!-- Google Search Console Verification -->
    <meta
      name="google-site-verification"
      content="D-jRaoys-yD6wLJMgBCGn9OBj4teSJK3QVN7k8QS394"
    />

    <!-- Google AdSense global script - Chargé de manière différée pour ne pas bloquer le rendu -->
    {% if ADSENSE_PUBLISHER_ID %}
    <script>
      // Charger AdSense seulement après le chargement complet de la page et si le consentement marketing est accepté
      (function() {
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(';').shift();
          return null;
        }

        function loadAdSense() {
          // Vérifier le consentement marketing (ou charger si pas de bannière cookies)
          const marketingConsent = getCookie('cookie_marketing');
          const cookieConsent = getCookie('cookie_consent');
          
          // Charger AdSense si :
          // - Le consentement marketing est accepté, OU
          // - Aucun consentement n'a été demandé (pas de bannière affichée)
          if (marketingConsent === 'accepted' || !cookieConsent) {
            var script = document.createElement('script');
            script.async = true;
            script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client={{ ADSENSE_PUBLISHER_ID }}';
            script.crossOrigin = 'anonymous';
            document.head.appendChild(script);
          }
        }

        // Utiliser requestIdleCallback pour charger AdSense quand le navigateur est inactif
        // Fallback pour les navigateurs qui ne supportent pas requestIdleCallback
        if ('requestIdleCallback' in window) {
          requestIdleCallback(function() {
            // Attendre encore un peu pour être sûr que le rendu initial est terminé
            setTimeout(loadAdSense, 2000);
          }, { timeout: 3000 });
        } else {
          // Fallback : attendre que la page soit complètement chargée
          if (document.readyState === 'loading') {
            window.addEventListener('load', function() {
              setTimeout(loadAdSense, 2000);
            });
          } else {
            setTimeout(loadAdSense, 2000);
          }
        }
      })();
    </script>
    {% endif %}

    <!-- Preconnect to external resources for faster loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="preconnect" href="https://unpkg.com" crossorigin />
    {% if GA_MEASUREMENT_ID %}
    <link
      rel="preconnect"
      href="https://www.googletagmanager.com"
      crossorigin
    />
    <link
      rel="preconnect"
      href="https://www.google-analytics.com"
      crossorigin
    />
    {% endif %}

    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://unpkg.com" />

    <!-- JSON-LD Structured Data - Organization & LocalBusiness (Amélioré selon Google) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "KIABA Rencontres",
        "alternateName": "KIABA",
        "url": "https://ci-kiaba.com",
        "description": "Site de rencontres adultes et d'annonces d'escort girls, escort boys et transgenres en Côte d'Ivoire.",
        "inLanguage": "fr-CI",
        "publisher": {
          "@type": "Organization",
          "@id": "https://ci-kiaba.com/#organization",
          "name": "KIABA",
          "legalName": "KIABA",
          "url": "https://ci-kiaba.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://ci-kiaba.com/static/img/logo.png?v=2",
            "width": 200,
            "height": 60
          },
          "image": "https://ci-kiaba.com/static/img/logo.png?v=2",
          "contactPoint": {
            "@type": "ContactPoint",
            "email": "support@ci-kiaba.com",
            "contactType": "customer service",
            "areaServed": "CI",
            "availableLanguage": ["fr", "fr-CI"]
          },
          "address": {
            "@type": "PostalAddress",
            "addressCountry": "CI",
            "addressLocality": "Abidjan",
            "addressRegion": "Lagunes"
          },
          "sameAs": ["https://ci-kiaba.com"]
        },
        "potentialAction": {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://ci-kiaba.com/ads?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      }
    </script>
    <script type="application/ld+json">
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "@id": "https://ci-kiaba.com/#localbusiness",
        "name": "KIABA Rencontres",
        "alternateName": "KIABA",
        "keywords": "kiaba, kiaba rencontres, site de rencontre adulte, escort girl, escort boy, transgenre, annonces adultes, escorte côte d'ivoire",
        "description": "KIABA - Site de rencontres adultes et d'annonces d'escorte en Côte d'Ivoire.",
        "url": "https://ci-kiaba.com",
        "telephone": "+225",
        "email": "support@ci-kiaba.com",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "",
          "addressLocality": "Abidjan",
          "addressRegion": "Lagunes",
          "postalCode": "",
          "addressCountry": "CI"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 5.36,
          "longitude": -4.0083
        },
        "areaServed": [
          {
            "@type": "Country",
            "name": "Côte d'Ivoire",
            "sameAs": "https://en.wikipedia.org/wiki/Ivory_Coast"
          },
          {
            "@type": "City",
            "name": "Abidjan"
          },
          {
            "@type": "City",
            "name": "Bouaké"
          },
          {
            "@type": "City",
            "name": "Daloa"
          }
        ],
        "priceRange": "Gratuit",
        "openingHours": "Mo-Su 00:00-23:59",
        "image": "https://ci-kiaba.com/static/img/logo.png?v=2",
        "logo": {
          "@type": "ImageObject",
          "url": "https://ci-kiaba.com/static/img/logo.png?v=2"
        }
      }
    </script>

    {% block structured_data %}{% endblock %}

    <!-- Favicon - Configuration complète pour Google et tous les navigateurs (?v=2 cache-bust) -->
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon.png' %}?v=2" />
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon.png' %}?v=2" />
    <link rel="shortcut icon" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="144x144" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="114x114" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="72x72" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'favicon.png' %}?v=2" />
    <link rel="apple-touch-icon" href="{% static 'favicon.png' %}?v=2" />
    <!-- Meta tags pour le favicon -->
    <meta name="msapplication-TileColor" content="#f97316" />
    <meta name="msapplication-TileImage" content="{% static 'favicon.png' %}?v=2" />
    <meta name="theme-color" content="#f97316" />

    <!-- Icônes Boxicons - Chargement asynchrone pour ne pas bloquer le rendu -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      media="print"
      onload="this.media='all'"
    />
    <noscript><link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"></noscript>

    {% block tailwind_css %}
    <!-- Tailwind CSS - Chargement asynchrone pour ne pas bloquer le rendu -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      media="print"
      onload="this.media='all'"
    />
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"></noscript>
    {% endblock %} {% block htmx_js %}
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
    {% endblock %}

    <!-- Google Fonts - Optimisé avec preconnect et display=swap -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>

    <style>
      /* Styles critiques pour éviter le flash */
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      }
      /* Cacher le body uniquement si on n'est pas en DEBUG (production) */
      body:not(.loaded) {
        visibility: hidden;
      }
      body.loaded {
        visibility: visible !important;
      }

      .glass {
        backdrop-filter: saturate(180%) blur(10px);
        background-color: rgba(255, 255, 255, 0.7);
      }
      .line-clamp-1 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
      }
      .line-clamp-2 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
      }

      /* Style pour les liens du footer au survol */
      footer a:hover {
        color: #f97316 !important;
      }

      /* CTA Section - Copié exactement de age_gate.html */
      .cta-section {
        background: linear-gradient(to bottom right, #f97316, #22c55e);
        color: #fff;
        padding: 0.75rem 1rem;
        text-align: center;
      }
      
      @media (min-width: 768px) {
        .cta-section {
          padding: 1rem;
        }
      }
      
      .cta-container {
        max-width: 80rem;
        margin-left: auto;
        margin-right: auto;
      }
      
      .cta-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
      }
      
      @media (min-width: 768px) {
        .cta-title {
          font-size: 1.25rem;
        }
      }
      
      .cta-text {
        color: #ffedd5;
        margin-bottom: 0.75rem;
        font-size: 0.875rem;
      }
      
      .cta-button {
        display: inline-flex;
        align-items: center;
        background-color: #fff;
        color: #ea580c;
        padding: 0.5rem 1.25rem;
        border-radius: 0.5rem;
        font-weight: 500;
        text-decoration: none;
        font-size: 0.875rem;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      }
      
      .cta-button:hover {
        background-color: #fff7ed;
      }
      
      .cta-icon {
        width: 1rem;
        height: 1rem;
        margin-right: 0.5rem;
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      /* Bandeau KIABA (pub interne) */
      .kiaba-banner {
        background-color: #111827; /* gris très foncé, sobre */
        border-radius: 0.75rem;
        border: 1px solid rgba(249, 115, 22, 0.35); /* léger rappel orange */
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      }
      .kiaba-banner-text,
      .kiaba-banner-cta,
      .kiaba-banner-logo {
        font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      }
      /* Texte orange -> dégradé vert animé */
      .kiaba-banner-text {
        background: linear-gradient(90deg, #f97316, #22c55e);
        background-size: 200% 100%;
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        animation: kiabaTextShift 4s ease-in-out infinite;
      }
      @keyframes kiabaTextShift {
        0% {
          background-position: 0% 0%;
        }
        50% {
          background-position: 100% 0%;
        }
        100% {
          background-position: 0% 0%;
        }
      }
      /* Logo qui tourne doucement */
      .kiaba-banner-logo img {
        animation: kiabaSpin 6s linear infinite;
        transform-origin: center center;
      }
      @keyframes kiabaSpin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .kiaba-banner-cta {
        background: linear-gradient(135deg, #f97316, #22c55e);
        color: #ffffff;
      }
      .kiaba-banner-cta:hover {
        background: linear-gradient(135deg, #ea580c, #16a34a);
      }

      /* Modale de chargement */
      .loading-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        align-items: center;
        justify-content: center;
      }
      .loading-modal.active {
        display: flex;
      }
      .loading-modal-content {
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        padding: 2rem;
        border-radius: 0.5rem;
        text-align: center;
        max-width: 300px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .loading-modal-content h3 {
        color: #111827;
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
      }
      .spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 3px solid #f3f4f6;
        border-top: 3px solid #6b7280;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .loading-modal-content p {
        color: #6b7280;
        font-size: 0.875rem;
        margin: 0;
      }

      /* Image de fête sur le logo */
      .logo-container {
        position: relative;
        display: inline-block;
      }
      .holiday-image {
        position: absolute;
        top: -18px;
        left: -12px;
        width: 56px;
        height: auto;
        z-index: 10;
        animation: holidayWiggle 2s ease-in-out infinite;
        transform-origin: bottom center;
      }
      @keyframes holidayWiggle {
        0%, 100% { transform: rotate(-5deg); }
        50% { transform: rotate(5deg); }
      }
    </style>

    <!-- Script pour afficher le body une fois la page chargée -->
    <script>
      // Afficher le body immédiatement - le CSS gère la visibilité
      (function() {
        // Ajouter la classe loaded immédiatement pour afficher le contenu
        if (document.body) {
          document.body.classList.add("loaded");
        } else {
          // Si le body n'est pas encore disponible, attendre
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", function () {
              document.body.classList.add("loaded");
            });
          } else {
            // Body déjà chargé
            document.body.classList.add("loaded");
          }
        }
        // Fallback au cas où DOMContentLoaded ne se déclenche pas
        window.addEventListener("load", function () {
          if (document.body) {
            document.body.classList.add("loaded");
          }
        });
      })();
    </script>

    {% block extra_head %}{% endblock %}
  </head>
  <body class="min-h-full bg-gradient-to-b from-orange-50 to-white">
    {% block header %}
    <header class="sticky top-0 z-40 glass border-b">
      <div
        class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"
      >
        <a href="/" class="text-2xl font-semibold tracking-tight text-gray-900">
      <div class="logo-container">
            <img
              src="{% static 'img/logo.png' %}?v=2"
              alt="KIABA Rencontres - Site de rencontres adultes en Côte d'Ivoire"
              class="h-12 md:h-16 w-auto"
              loading="eager"
              fetchpriority="high"
              width="264"
              height="112"
            />
          </div>
        </a>
        <nav class="hidden md:flex items-center gap-3">
          <a href="/ads" class="text-gray-700 hover:text-gray-900">Annonces</a>
          {% if user.is_authenticated %}
          <a
            href="/dashboard/"
            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition font-medium"
          >
            Mon compte
          </a>
          {% else %}
          <a
            href="/auth/login/"
            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition font-medium"
          >
            Se connecter
          </a>
          {% endif %}
        </nav>
        <div class="md:hidden flex items-center gap-2">
          {% if user.is_authenticated %}
          <a
            href="/dashboard/"
            class="bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium"
            >Mon compte</a
          >
          {% else %}
          <a
            href="/auth/login/"
            class="bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium"
            >Se connecter</a
          >
          {% endif %}
        </div>
      </div>
    </header>
    {% endblock %}

    {% block cta_section %}
    <!-- CTA Publier après le header (uniforme sur toutes les pages) -->
    <section class="cta-section">
      <div class="cta-container">
        <h2 class="cta-title">Vous proposez des services ?</h2>
        <p class="cta-text">Publiez votre annonce gratuitement sur KIABA Rencontres et augmentez votre visibilité</p>
        <a href="/post/" class="cta-button">
          <svg class="cta-icon" viewBox="0 0 24 24">
            <path d="M12 4v16m8-8H4"></path>
          </svg>
          Publier une annonce
        </a>
      </div>
    </section>
    {% endblock %} {% block counter_section %}
    <!-- Compteur d'annonces -->
    <section class="bg-white border-b">
      <div
        class="max-w-7xl mx-auto px-4 py-3 text-center text-sm text-gray-700"
      >
        <span
          >Nombre total d'annonces en ligne :
          <strong>{{ total_approved_ads }}</strong></span
        >
      </div>
    </section>
    {% endblock %}

    <main
      class="{% block main_class %}max-w-7xl mx-auto p-3 md:p-4{% endblock %}"
    >
      {% if messages %}
      <div class="max-w-3xl mx-auto mb-4 space-y-2" id="messagesContainer" data-messages-count="{{ messages|length }}">
        {% for message in messages %}
        <div
          class="message-toast rounded-lg border px-4 py-3 text-sm opacity-0 transform translate-y-2 transition-all duration-300 {% if message.tags == 'success' %} bg-green-50 border-green-200 text-green-800 {% endif %} {% if message.tags == 'info' %} bg-orange-50 border-orange-200 text-orange-800 {% endif %} {% if message.tags == 'warning' %} bg-yellow-50 border-yellow-200 text-yellow-800 {% endif %} {% if message.tags == 'error' %} bg-red-50 border-red-200 text-red-800 {% endif %}"
          data-message-text="{{ message|escapejs }}"
          data-message-timestamp="{{ forloop.counter }}"
        >
          <div class="flex items-center justify-between gap-3">
            <span>{{ message }}</span>
            <button class="message-close text-gray-400 hover:text-gray-600 transition" aria-label="Fermer">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-4 w-4">
                <path d="M18 6L6 18M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Breadcrumbs -->
      {% block breadcrumbs %}{% endblock %} {% block content %}{% endblock %}
    </main>

    <footer class="bg-gray-50 border-t border-gray-200 mt-8">
      <div class="max-w-7xl mx-auto p-6">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-6">
          <!-- Navigation -->
          <div>
            <h3 class="font-semibold text-gray-900 mb-3">Navigation</h3>
            <ul class="space-y-2 text-sm text-gray-600">
              <li>
                <a href="/ads" class="hover:text-orange-600 transition-colors"
                  >Annonces</a
                >
              </li>
              <li>
                <a href="/post" class="hover:text-orange-600 transition-colors"
                  >Publier une annonce</a
                >
              </li>
              <li>
                <a href="/legal/tos" class="hover:text-orange-600 transition-colors"
                  >CGU</a
                >
              </li>
              <li>
                <a href="/legal/privacy" class="hover:text-orange-600 transition-colors"
                  >Confidentialité</a
                >
              </li>
              <li>
                <a
                  href="/legal/content-policy"
                  class="hover:text-orange-600 transition-colors"
                  >Politique de contenu</a
                >
              </li>
            </ul>
          </div>

          <!-- Villes populaires (SEO - maillage interne) -->
          {% if popular_cities_footer %}
          <div>
            <h3 class="font-semibold text-gray-900 mb-3">Villes populaires</h3>
            <ul class="space-y-2 text-sm text-gray-600">
              {% for city in popular_cities_footer %}
              <li>
                <a
                  href="/ads?city={{ city.slug }}"
                  class="hover:text-orange-600 transition-colors"
                  >Annonces à {{ city.name }}</a
                >
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}

          <!-- Contact -->
          <div>
            <h3 class="font-semibold text-gray-900 mb-3">Contact</h3>
            <ul class="space-y-2 text-sm text-gray-600">
              <li>
                Email:
                <a
                  href="mailto:support@ci-kiaba.com"
                  class="hover:text-orange-600 transition-colors"
                  >support@ci-kiaba.com</a
                >
              </li>
              <li>© 2025 KIABA Rencontres</li>
              <li class="text-xs text-gray-500">Côte d'Ivoire</li>
            </ul>
          </div>
        </div>

        <!-- Copyright -->
        <div
          class="border-t border-gray-200 pt-4 text-center text-xs text-gray-500"
        >
          <p>
            © 2025 KIABA Rencontres - Site de rencontres adultes en Côte d'Ivoire
          </p>
        </div>
      </div>
    </footer>

    <!-- Modale de chargement -->
    <div id="loadingModal" class="loading-modal">
      <div class="loading-modal-content">
        <div class="spinner"></div>
        <h3 id="loadingTitle">Chargement...</h3>
        <p id="loadingMessage">Veuillez patienter</p>
      </div>
    </div>

    <!-- Script pour gérer les modales de chargement -->
    <script>
      // Fonction pour afficher la modale de chargement
      function showLoadingModal(title, message) {
        const modal = document.getElementById('loadingModal');
        const titleEl = document.getElementById('loadingTitle');
        const messageEl = document.getElementById('loadingMessage');
        
        if (title) titleEl.textContent = title;
        if (message) messageEl.textContent = message;
        
        modal.classList.add('active');
      }

      // Fonction pour masquer la modale de chargement
      function hideLoadingModal() {
        const modal = document.getElementById('loadingModal');
        modal.classList.remove('active');
      }

      // Gérer les messages toast (apparition/disparition automatique + éviter réaffichage)
      document.addEventListener('DOMContentLoaded', function() {
        const messages = document.querySelectorAll('.message-toast');
        const messagesContainer = document.getElementById('messagesContainer');
        
        // Récupérer les messages déjà affichés depuis localStorage
        const displayedMessages = JSON.parse(localStorage.getItem('displayed_messages') || '[]');
        const currentTime = Date.now();
        const MESSAGE_TTL = 60000; // 1 minute - les messages peuvent réapparaître après 1 minute
        
        // Nettoyer les anciens messages (plus de 1 minute)
        const cleanedMessages = displayedMessages.filter(function(msg) {
          return (currentTime - msg.timestamp) < MESSAGE_TTL;
        });
        localStorage.setItem('displayed_messages', JSON.stringify(cleanedMessages));
        
        messages.forEach(function(message, index) {
          const messageText = message.getAttribute('data-message-text');
          const messageHash = btoa(messageText).substring(0, 16); // Hash simple du message
          
          // Vérifier si ce message a déjà été affiché récemment
          const alreadyDisplayed = cleanedMessages.some(function(msg) {
            return msg.hash === messageHash && (currentTime - msg.timestamp) < MESSAGE_TTL;
          });
          
          if (alreadyDisplayed) {
            // Message déjà affiché récemment, le supprimer du DOM
            message.remove();
            return;
          }
          
          // Marquer ce message comme affiché
          cleanedMessages.push({
            hash: messageHash,
            timestamp: currentTime
          });
          localStorage.setItem('displayed_messages', JSON.stringify(cleanedMessages));
          
          // Animation d'apparition
          setTimeout(function() {
            message.classList.remove('opacity-0', 'translate-y-2');
            message.classList.add('opacity-100', 'translate-y-0');
          }, 100 * (index + 1)); // Délai progressif pour chaque message
          
          // Disparition automatique après 5 secondes
          const autoHideTimeout = setTimeout(function() {
            message.classList.add('opacity-0', 'translate-y-2');
            setTimeout(function() {
              message.remove();
            }, 300); // Attendre la fin de l'animation
          }, 5000); // 5 secondes
          
          // Bouton de fermeture manuelle
          const closeBtn = message.querySelector('.message-close');
          if (closeBtn) {
            closeBtn.addEventListener('click', function() {
              clearTimeout(autoHideTimeout);
              message.classList.add('opacity-0', 'translate-y-2');
              setTimeout(function() {
                message.remove();
              }, 300);
            });
          }
        });
        
        // Si tous les messages ont été supprimés, supprimer le conteneur
        setTimeout(function() {
          if (messagesContainer && messagesContainer.querySelectorAll('.message-toast').length === 0) {
            messagesContainer.remove();
          }
        }, 6000);
      });

      // Gérer la soumission des formulaires
      document.addEventListener('DOMContentLoaded', function() {
        // Détecter le formulaire de création d'annonce (formulaire spécifique avec id="postAdForm")
        const postForm = document.getElementById('postAdForm');
        if (postForm) {
          postForm.addEventListener('submit', function(e) {
            // Vérifier que le formulaire est valide avant d'afficher le loader
            if (this.checkValidity()) {
              showLoadingModal("Création de l'annonce", "Votre annonce est en cours de création, veuillez patienter...");
            }
          });
        }

        // Gérer la soumission du formulaire de connexion
        const loginForm = document.querySelector('form[action*="login"]');
        if (loginForm) {
          loginForm.addEventListener('submit', function(e) {
            if (this.checkValidity()) {
              showLoadingModal('Connexion en cours', 'Authentification en cours, veuillez patienter...');
            }
          });
        }

        // Gérer la soumission du formulaire d'inscription
        const signupForm = document.querySelector('form[action*="signup"]');
        if (signupForm) {
          signupForm.addEventListener('submit', function(e) {
            if (this.checkValidity()) {
              showLoadingModal('Inscription en cours', 'Création de votre compte, veuillez patienter...');
            }
          });
        }

        // Gérer la soumission du formulaire de modification de profil
        const profileEditForm = document.getElementById('profileEditForm');
        if (profileEditForm) {
          profileEditForm.addEventListener('submit', function(e) {
            if (this.checkValidity()) {
              showLoadingModal('Modification du profil', 'Votre profil est en cours de modification, veuillez patienter...');
            }
          });
        }

        // Gérer les liens de déconnexion
        const logoutLinks = document.querySelectorAll('a[href*="logout"]');
        logoutLinks.forEach(function(link) {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const url = this.getAttribute('href');
            showLoadingModal('Déconnexion', 'Déconnexion en cours...');
            
            // Rediriger après un court délai pour que la modale s'affiche
            setTimeout(function() {
              window.location.href = url;
            }, 300);
          });
        });

        // Masquer la modale si la page se recharge (en cas d'erreur)
        window.addEventListener('pageshow', function(event) {
          if (event.persisted) {
            hideLoadingModal();
          }
        });

        // Masquer la modale si on revient en arrière
        window.addEventListener('popstate', function() {
          hideLoadingModal();
        });
      });
    </script>

    {% block extra_js %}{% endblock %}

    <!-- Bannière de consentement aux cookies -->
    <div id="cookieBanner" class="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 shadow-lg z-50 hidden">
      <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex-1 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-6 w-6 flex-shrink-0 text-orange-400">
            <circle cx="12" cy="12" r="10" fill="currentColor" opacity="0.1"/>
            <circle cx="12" cy="12" r="10" stroke="currentColor"/>
            <circle cx="8" cy="9" r="1.5" fill="currentColor"/>
            <circle cx="16" cy="9" r="1.5" fill="currentColor"/>
            <circle cx="8" cy="15" r="1.5" fill="currentColor"/>
            <circle cx="16" cy="15" r="1.5" fill="currentColor"/>
            <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
          </svg>
          <p class="text-sm">
            Nous utilisons des cookies pour améliorer votre expérience sur KIABA Rencontres. 
            En continuant, vous acceptez notre utilisation des cookies. 
            <a href="/legal/privacy" class="underline hover:text-orange-400">En savoir plus</a>
          </p>
        </div>
        <div class="flex gap-2">
          <button id="cookieAcceptAll" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium transition">
            Tout accepter
          </button>
          <button id="cookieRejectAll" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-sm font-medium transition">
            Refuser
          </button>
          <button id="cookieCustomize" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg text-sm font-medium transition">
            Personnaliser
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de personnalisation des cookies -->
    <div id="cookieModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Gestion des cookies</h2>
        <p class="text-gray-600 mb-6">
          Choisissez les cookies que vous souhaitez accepter. Les cookies essentiels sont nécessaires au fonctionnement du site.
        </p>
        
        <div class="space-y-4 mb-6">
          <div class="border-b pb-4">
            <div class="flex items-center justify-between mb-2">
              <div>
                <h3 class="font-semibold text-gray-900">Cookies essentiels</h3>
                <p class="text-sm text-gray-600">Nécessaires au fonctionnement du site (sessions, sécurité)</p>
              </div>
              <span class="text-green-600 font-semibold">Toujours actifs</span>
            </div>
          </div>
          
          <div class="border-b pb-4">
            <div class="flex items-center justify-between mb-2">
              <div>
                <h3 class="font-semibold text-gray-900">Cookies analytiques</h3>
                <p class="text-sm text-gray-600">Nous aident à comprendre comment vous utilisez le site (Google Analytics)</p>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="cookieAnalytics" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"></div>
              </label>
            </div>
          </div>
          
          <div class="border-b pb-4">
            <div class="flex items-center justify-between mb-2">
              <div>
                <h3 class="font-semibold text-gray-900">Cookies marketing</h3>
                <p class="text-sm text-gray-600">Pour personnaliser les publicités (actuellement non utilisés)</p>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="cookieMarketing" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"></div>
              </label>
            </div>
          </div>
        </div>
        
        <div class="flex gap-2 justify-end">
          <button id="cookieSave" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition">
            Enregistrer les préférences
          </button>
          <button id="cookieCancel" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg font-medium transition">
            Annuler
          </button>
        </div>
      </div>
    </div>

    <!-- Script de gestion des cookies -->
    <script>
      (function() {
        // Vérifier si le consentement existe déjà
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(';').shift();
          return null;
        }

        const cookieConsent = getCookie('cookie_consent');
        const banner = document.getElementById('cookieBanner');
        const modal = document.getElementById('cookieModal');

        // Afficher la bannière UNIQUEMENT si pas de consentement (ni accepté, ni refusé)
        // Si cookie_consent existe (même avec valeur "rejected"), ne pas afficher
        if (!cookieConsent) {
          banner.classList.remove('hidden');
        } else {
          // Consentement déjà donné ou refusé, ne jamais afficher
          banner.classList.add('hidden');
        }

        // Gestion des boutons
        document.getElementById('cookieAcceptAll')?.addEventListener('click', function() {
          saveCookieConsent({ analytics: true, marketing: true });
        });

        document.getElementById('cookieRejectAll')?.addEventListener('click', function() {
          // Même en refusant, on crée le cookie pour ne plus afficher la bannière
          saveCookieConsent({ analytics: false, marketing: false });
        });

        document.getElementById('cookieCustomize')?.addEventListener('click', function() {
          modal.classList.remove('hidden');
          modal.classList.add('flex');
        });

        document.getElementById('cookieCancel')?.addEventListener('click', function() {
          modal.classList.add('hidden');
          modal.classList.remove('flex');
        });

        document.getElementById('cookieSave')?.addEventListener('click', function() {
          const analytics = document.getElementById('cookieAnalytics').checked;
          const marketing = document.getElementById('cookieMarketing').checked;
          saveCookieConsent({ analytics, marketing });
          modal.classList.add('hidden');
          modal.classList.remove('flex');
        });

        function saveCookieConsent(consent) {
          fetch('/api/cookie-consent/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': getCookie('csrftoken') || ''
            },
            body: JSON.stringify({ consent })
          })
          .then(() => {
            // Masquer la bannière immédiatement
            banner.classList.add('hidden');
            
            // Sauvegarder aussi dans localStorage pour éviter les rechargements
            localStorage.setItem('cookie_consent_saved', 'true');
            
            // Recharger Google Analytics si accepté
            if (consent.analytics && typeof gtag !== 'undefined') {
              gtag('consent', 'update', {
                'analytics_storage': 'granted'
              });
            }
            
            // Ne pas recharger la page, juste masquer la bannière
            // location.reload(); // Commenté pour éviter le rechargement
          })
          .catch(err => console.error('Erreur lors de la sauvegarde des préférences:', err));
        }
        
        // Vérifier aussi localStorage au chargement
        if (localStorage.getItem('cookie_consent_saved') === 'true') {
          banner.classList.add('hidden');
        }
      })();
    </script>

    <!-- Google Analytics - Respect du consentement -->
    {% if GA_MEASUREMENT_ID %}
    <script>
      // Vérifier le consentement avant de charger GA
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }

      const analyticsConsent = getCookie('cookie_analytics');
      
      if (analyticsConsent === 'accepted') {
        // Charger GA seulement si le consentement est donné
        window.addEventListener("load", function () {
          var script = document.createElement("script");
          script.async = true;
          script.src =
            "https://www.googletagmanager.com/gtag/js?id={{ GA_MEASUREMENT_ID }}";
          document.head.appendChild(script);

          script.onload = function () {
            window.dataLayer = window.dataLayer || [];
            function gtag() {
              dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", "{{ GA_MEASUREMENT_ID }}", {
              'anonymize_ip': true,
              'cookie_flags': 'SameSite=None;Secure'
            });
          };
        });
      }
    </script>
    {% endif %}
  </body>
</html>
